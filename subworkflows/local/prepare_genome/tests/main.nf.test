nextflow_workflow {

    name "Test Subworkflow PREPARE_GENOME"
    script "../main.nf"
    workflow "PREPARE_GENOME"
    config "./nextflow.config"

    tag "BBMAP_BBSPLIT"
    tag "CUSTOM_CATADDITIONALFASTA"
    tag "CUSTOM_GETCHROMSIZES"
    tag "GFFREAD"
    tag "GTF2BED"
    tag "GTF_FILTER"
    tag "GUNZIP"
    tag "HISAT2_BUILD"
    tag "HISAT2_EXTRACTSPLICESITES"
    tag "KALLISTO_INDEX"
    tag "PREPROCESS_TRANSCRIPTS_FASTA_GENCODE"
    tag "RSEM_PREPAREREFERENCE"
    tag "SALMON_INDEX"
    tag "SORTMERNA"
    tag "STAR_GENOMEGENERATE"
    tag "STAR_GENOMEGENERATE_IGENOMES"
    tag "UNTAR"

    test("default options") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("gencode = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_gtf_filter") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = true
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_bbsplit") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = true
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_alignment") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = true
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_psuedo_alignment") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = true

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("gtf = false") {

        when {
            workflow {
                """
                gencode                  = true
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = false
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("gff = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = false
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("gfp = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = false
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("transcriptome = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = false
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("with bed") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = file(params.pipelines_testdata_base_path + 'reference/ngscheckmate.bed', checkIfExists: true)
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("rsem_index = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = false
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("salmon_index = false") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = false
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("hisat2_index = false") {
        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0]  = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1]  = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2]  = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3]  = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4]  = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5]  = null
                input[6]  = null
                input[7]  = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8]  = null
                input[9]  = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = false
                input[12] = null
                input[13] = false
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("gencode = true") {

        when {
            workflow {
                """
                gencode                  = true
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("featurecounts_group_type = 'gene_type'") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_type'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_gtf_filter = true") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = true
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_bbsplit = true") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = true
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_alignment = true") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = true
                skip_pseudo_alignment    = false

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

    test("skip_pseudoalignment = true") {

        when {
            workflow {
                """
                gencode                  = false
                featurecounts_group_type = 'gene_biotype'
                aligner                  = 'star_salmon,star_rsem,hisat2'
                pseudo_aligner           = 'salmon,kallisto'
                skip_gtf_filter           = false
                skip_bbsplit             = false
                skip_sortmerna           = true
                skip_alignment           = false
                skip_pseudo_alignment    = true

                input[0] = file(params.pipelines_testdata_base_path + 'reference/genome.fasta', checkIfExists: true)
                input[1] = file(params.pipelines_testdata_base_path + 'reference/genes_with_empty_tid.gtf', checkIfExists: true)
                input[2] = file(params.pipelines_testdata_base_path + 'reference/genes.gff', checkIfExists: true)
                input[3] = file(params.pipelines_testdata_base_path + 'reference/gfp.fa', checkIfExists: true)
                input[4] = file(params.pipelines_testdata_base_path + 'reference/transcriptome.fasta', checkIfExists: true)
                input[5] = null
                input[6] = null
                input[7] = file(params.pipelines_testdata_base_path + 'reference/bbsplit_fasta_list.txt', checkIfExists: true)
                input[8] = null
                input[9] = null
                input[10] = file(params.pipelines_testdata_base_path + 'reference/rsem.tar.gz', checkIfExists: true)
                input[11] = file(params.pipelines_testdata_base_path + 'reference/salmon.tar.gz', checkIfExists: true)
                input[12] = null
                input[13] = file(params.pipelines_testdata_base_path + 'reference/hisat2.tar.gz', checkIfExists: true)
                input[14] = null
                input[15] = null
                input[16] = gencode
                input[17] = featurecounts_group_type
                input[18] = aligner
                input[19] = pseudo_aligner
                input[20] = skip_gtf_filter
                input[21] = skip_bbsplit
                input[22] = skip_sortmerna
                input[23] = skip_alignment
                input[24] = skip_pseudo_alignment
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success},
                { assert snapshot(
                    workflow.out.transcript_fasta,
                    workflow.out.salmon_index,
                    workflow.out.fasta,
                    workflow.out.gtf,
                    workflow.out.fai,
                    workflow.out.gene_bed,
                    workflow.out.chrom_sizes,
                    workflow.out.splicesites,
                    // workflow.out.bbsplit_index,
                    workflow.out.sortmerna_index,
                    workflow.out.star_index,
                    workflow.out.rsem_index,
                    workflow.out.hisat2_index,
                    workflow.out.kallisto_index,
                    workflow.out.versions
                ).match() }
            )
        }
    }

}
